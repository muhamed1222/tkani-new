# Руководство по тестированию API

## Настройка

1. Убедитесь, что файл `.env` создан и содержит правильный URL API:
```env
VITE_API_URL=http://localhost:5001/api
```

2. Запустите проект:
```bash
npm run dev
```

## Тестирование аутентификации

### 1. Регистрация пользователя

**Endpoint:** `POST /api/auth/register`

**Ожидаемый формат запроса:**
```json
{
  "firstName": "Иван",
  "lastName": "Иванов",
  "email": "ivan@example.com",
  "phone": "+79991234567",
  "password": "password123"
}
```

**Ожидаемый формат ответа:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "firstName": "Иван",
    "lastName": "Иванов",
    "email": "ivan@example.com",
    "phone": "+79991234567"
  }
}
```

**Как протестировать:**
1. Откройте страницу регистрации: `/registration`
2. Заполните форму
3. Нажмите "Создать аккаунт"
4. Проверьте, что токен сохранился в `localStorage` (ключ: `authToken`)
5. Проверьте, что произошел редирект на главную страницу

### 2. Вход пользователя

**Endpoint:** `POST /api/auth/login`

**Ожидаемый формат запроса:**
```json
{
  "email": "ivan@example.com",
  "password": "password123"
}
```

**Ожидаемый формат ответа:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "firstName": "Иван",
    "lastName": "Иванов",
    "email": "ivan@example.com"
  }
}
```

**Как протестировать:**
1. Откройте страницу входа: `/login`
2. Введите email и пароль
3. Нажмите "Войти"
4. Проверьте, что токен сохранился
5. Проверьте, что произошел редирект

### 3. Проверка авторизации

**Endpoint:** `GET /api/auth/me`

**Заголовки:**
```
Authorization: Bearer <token>
```

**Ожидаемый формат ответа:**
```json
{
  "user": {
    "id": 1,
    "firstName": "Иван",
    "lastName": "Иванов",
    "email": "ivan@example.com"
  }
}
```

**Как протестировать:**
1. При загрузке приложения автоматически проверяется токен
2. Если токен валидный, пользователь остается авторизованным
3. Если токен невалидный (401/403), происходит выход

### 4. Выход

**Endpoint:** `POST /api/auth/logout`

**Заголовки:**
```
Authorization: Bearer <token>
```

**Как протестировать:**
1. Войдите в систему
2. Нажмите на аватар в навигации
3. Выберите "Выйти"
4. Проверьте, что токен удален из `localStorage`
5. Проверьте, что произошел редирект на главную

## Тестирование товаров (Tkans)

### 1. Получение всех товаров

**Endpoint:** `GET /api/tkans`

**Query параметры (опционально):**
- `type` - фильтр по типу
- `brand` - фильтр по бренду
- `page` - номер страницы
- `limit` - количество на странице

**Ожидаемый формат ответа:**
```json
[
  {
    "id": 1,
    "name": "Двунитка Мокрый Асфальт",
    "price": 800,
    "rating": 5,
    "img": "/image_wet_asphalt_1.png"
  },
  ...
]
```

Или с метаданными:
```json
{
  "tkans": [...],
  "total": 10,
  "page": 1,
  "totalPages": 1
}
```

**Как протестировать:**
1. Откройте главную страницу или каталог
2. Товары должны загрузиться автоматически
3. Если API недоступен, используются моковые данные

### 2. Получение товара по ID

**Endpoint:** `GET /api/tkans/:id`

**Как протестировать:**
1. Откройте страницу товара: `/tkan/1`
2. Проверьте загрузку данных

### 3. Получение типов товаров

**Endpoint:** `GET /api/tkans/types`

**Ожидаемый формат ответа:**
```json
[
  { "id": 1, "name": "Для дома" },
  { "id": 2, "name": "Для шитья" }
]
```

### 4. Получение брендов

**Endpoint:** `GET /api/tkans/brands`

**Ожидаемый формат ответа:**
```json
[
  { "id": 1, "name": "Египет" },
  { "id": 2, "name": "Азия" }
]
```

## Тестирование работ (Works)

### 1. Получение всех работ

**Endpoint:** `GET /api/works?page=1&limit=12`

**Ожидаемый формат ответа:**
```json
{
  "works": [
    {
      "id": 1,
      "title": "Платье из вискозного шифона",
      "image": "/path/to/image.jpg",
      "link": "/work/1"
    },
    ...
  ],
  "total": 12,
  "page": 1,
  "totalPages": 1
}
```

**Как протестировать:**
1. Откройте страницу: `/our_works`
2. Проверьте загрузку работ с пагинацией

## Проверка токенов в браузере

### Chrome DevTools

1. Откройте DevTools (F12)
2. Перейдите на вкладку "Application"
3. В левом меню выберите "Local Storage"
4. Найдите ваш домен
5. Проверьте наличие ключа `authToken`

### Проверка токена в консоли

```javascript
// Проверить наличие токена
localStorage.getItem('authToken')

// Удалить токен (для тестирования)
localStorage.removeItem('authToken')
```

## Обработка ошибок

### Ошибки API

Приложение автоматически обрабатывает следующие ошибки:

- **401 Unauthorized** - токен невалидный, происходит выход
- **403 Forbidden** - нет доступа, происходит выход
- **404 Not Found** - ресурс не найден
- **500 Server Error** - ошибка сервера

Все ошибки логируются в консоль только в режиме разработки.

## Fallback на моковые данные

Если API недоступен, приложение автоматически использует моковые данные:

- **TkanStore** - использует 4 моковых товара
- **WorksStore** - использует 12 моковых работ

Это позволяет продолжать разработку без бэкенда.

## Тестирование с реальным API

1. Убедитесь, что ваш API сервер запущен
2. Обновите `.env` файл с правильным URL
3. Перезапустите приложение: `npm run dev`
4. Проверьте Network вкладку в DevTools для просмотра запросов

## Примеры запросов через curl

### Регистрация
```bash
curl -X POST http://localhost:5001/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "firstName": "Иван",
    "lastName": "Иванов",
    "email": "ivan@example.com",
    "phone": "+79991234567",
    "password": "password123"
  }'
```

### Вход
```bash
curl -X POST http://localhost:5001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "ivan@example.com",
    "password": "password123"
  }'
```

### Получение товаров
```bash
curl -X GET http://localhost:5001/api/tkans
```

### Получение работ
```bash
curl -X GET "http://localhost:5001/api/works?page=1&limit=12"
```

