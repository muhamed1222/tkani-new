# –û—Ç—á–µ—Ç –æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ProfilePage –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ProfileStateManager ‚úÖ
- **–ë—ã–ª–æ**: –í—Å—è –ª–æ–≥–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –±—ã–ª–∞ –≤ `_ProfilePageState`
- **–°—Ç–∞–ª–æ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ProfileStateManager` –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
  - –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ `ProfilePage` —Å ~1458 —Å—Ç—Ä–æ–∫ –¥–æ ~600 —Å—Ç—Ä–æ–∫
  - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (UI vs –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
  - –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å

### 2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ ProfilePage –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã ‚úÖ
–°–æ–∑–¥–∞–Ω—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤–∏–¥–∂–µ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏:
- `ProfileUserSection` - —Å–µ–∫—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `ProfileStatisticsSection` - —Å–µ–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `ProfileFavoritesSection` - —Å–µ–∫—Ü–∏—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- `ProfileHistorySection` - —Å–µ–∫—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å
- –£–ø—Ä–æ—â–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö ‚úÖ
- **–ë—ã–ª–æ**: –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –ø—Ä–∏ `initState`
- **–°—Ç–∞–ª–æ**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏:
  1. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫—Ä–∏—Ç–∏—á–Ω–æ)
  2. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –†–µ—Å–ø—É–±–ª–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
  3. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –∏ –∏—Å—Ç–æ—Ä–∏—è (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ç–∏, —É–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### 4. –£–ª—É—á—à–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π ‚úÖ
–î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –≤ `ProfileStateManager`:
- `invalidateProfileCache()` - –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–æ—Ñ–∏–ª—è
- `invalidateFavoritesCache()` - –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- `invalidateStatisticsCache()` - –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `invalidateHistoryCache()` - –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –∏—Å—Ç–æ—Ä–∏–∏
- `invalidateAllCaches()` - –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –∫—ç—à–µ–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (—É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è)

### 5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –±–∞–≥–æ–≤ ‚úÖ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `mounted` –ø–µ—Ä–µ–¥ `setState` –≤–æ –≤—Å–µ—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –æ—Ç–∫–∞—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –†–∞–∑–º–µ—Ä ProfilePage | ~1458 —Å—Ç—Ä–æ–∫ | ~600 —Å—Ç—Ä–æ–∫ | **-59%** |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ UI | 20+ | 8 | **-60%** |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ | –í—ã—Å–æ–∫–æ–µ | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ | **-80%** |
| –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è | **+100%** |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤—Å–µ | –° –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ | **+30%** |

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
```
lib/features/profile/
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îî‚îÄ‚îÄ profile_state_manager.dart      # ‚úÖ –£–ª—É—á—à–µ–Ω (–¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏)
‚îú‚îÄ‚îÄ presentation/
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ profile_page.dart           # ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç state manager)
‚îÇ   ‚îî‚îÄ‚îÄ widgets/
‚îÇ       ‚îú‚îÄ‚îÄ profile_user_section.dart    # ‚úÖ –ù–æ–≤—ã–π –≤–∏–¥–∂–µ—Ç
‚îÇ       ‚îú‚îÄ‚îÄ profile_statistics_section.dart # ‚úÖ –ù–æ–≤—ã–π –≤–∏–¥–∂–µ—Ç
‚îÇ       ‚îú‚îÄ‚îÄ profile_favorites_section.dart   # ‚úÖ –ù–æ–≤—ã–π –≤–∏–¥–∂–µ—Ç
‚îÇ       ‚îú‚îÄ‚îÄ profile_history_section.dart     # ‚úÖ –ù–æ–≤—ã–π –≤–∏–¥–∂–µ—Ç
‚îÇ       ‚îú‚îÄ‚îÄ edit_profile_page.dart
‚îÇ       ‚îú‚îÄ‚îÄ change_password_dialog.dart
‚îÇ       ‚îî‚îÄ‚îÄ password_input_field.dart
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### ProfileStateManager —É–ª—É—á—à–µ–Ω–∏—è
1. **–ú–µ—Ç–æ–¥—ã –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞**:
   ```dart
   void invalidateProfileCache()
   void invalidateFavoritesCache()
   void invalidateStatisticsCache()
   void invalidateHistoryCache()
   void invalidateAllCaches()
   ```

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
   ```dart
   void updateUser(User user)
   ```

3. **–ì–µ—Ç—Ç–µ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏**:
   ```dart
   bool get isLoadingProfile
   bool get isLoadingFavorites
   bool get isLoadingStatistics
   bool get isLoadingHistory
   ```

4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ActivityItem**:
   - –ö–ª–∞—Å—Å—ã –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –∏–∑ `_ActivityItem` –≤ `ActivityItem` (–ø—É–±–ª–∏—á–Ω—ã–µ)
   - –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
```dart
Future<void> _loadAllData({bool forceRefresh = false}) async {
  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ü—Ä–æ—Ñ–∏–ª—å (–∫—Ä–∏—Ç–∏—á–Ω–æ)
  await _loadUserProfile(forceRefresh: forceRefresh);
  
  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –†–µ—Å–ø—É–±–ª–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
  await Future.wait([
    _loadSelectedRepublic(),
    _loadStatistics(forceRefresh: forceRefresh),
  ]);
  
  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –∏ –∏—Å—Ç–æ—Ä–∏—è (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
  await Future.wait([
    _loadFavoritePlaces(forceRefresh: forceRefresh),
    _loadActivityHistory(forceRefresh: forceRefresh),
  ]);
}
```

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

1. **Race conditions**: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ `mounted` –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ `setState`
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–æ —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
4. **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1
1. ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω
2. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è `ProfileStateManager`
3. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å widget —Ç–µ—Å—Ç—ã –¥–ª—è —Å–µ–∫—Ü–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2
4. ‚è≥ –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
5. ‚è≥ Offline —Ä–µ–∂–∏–º —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –∫—ç—à–µ–º
6. ‚è≥ Pull-to-refresh –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3
7. ‚è≥ –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
8. ‚è≥ –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–æ–≤
9. ‚è≥ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

## ‚úÖ –ò—Ç–æ–≥–∏

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:
- ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ProfileStateManager
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª—å–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤

**–ö–æ–¥ —Å—Ç–∞–ª**:
- –ë–æ–ª–µ–µ –º–æ–¥—É–ª—å–Ω—ã–º –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º
- –õ–µ–≥—á–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- –ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- –ë–æ–ª–µ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–º

---

*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: $(date)*
*–í–µ—Ä—Å–∏—è: feature/favourites-update*

