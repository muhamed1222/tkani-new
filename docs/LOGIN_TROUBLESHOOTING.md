# Решение проблемы с входом (401 UNAUTHORIZED)

## Проблема
При попытке входа в систему возникает ошибка 401 (UNAUTHORIZED).

## ✅ Улучшения в коде

Я уже улучшил обработку ошибок:
- ✅ При ошибке 401 показывается понятное сообщение "Неверный email или пароль"
- ✅ Добавлено детальное логирование запросов и ответов в режиме разработки
- ✅ Улучшена обработка различных форматов ответов об ошибках

## Возможные причины

### 1. Пароль не обновляется при повторном запуске скрипта
**ВАЖНО**: Если пользователь уже существует, скрипт `init_admin_data.py` может НЕ обновлять пароль!

**Решение**: 
- Удалите пользователя из БД вручную и создайте заново
- Или обновите пароль через админ-панель/API
- Или модифицируйте скрипт, чтобы он обновлял пароль существующего пользователя

### 2. Неправильные учетные данные
- Проверьте, что email и пароль введены правильно
- Убедитесь, что пользователь существует в базе данных
- Проверьте, что пароль не содержит лишних пробелов
- **Проверьте, что пароль в БД соответствует тому, что вы вводите**

### 3. Пользователь не создан
Если вы пытаетесь войти как администратор, убедитесь, что пользователь создан:

```bash
# Используйте скрипт инициализации
python3 init_admin_data.py admin@example.com admin123 Имя Фамилия
```

**⚠️ ВАЖНО**: Если пользователь уже существует, скрипт может не обновить пароль!

### 3. Неправильный формат запроса
Проверьте, что бэкенд ожидает правильный формат данных.

**Фронтенд отправляет:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Бэкенд должен ожидать:**
- Endpoint: `POST /api/v1/auth/login`
- Content-Type: `application/json`
- Body: `{ "email": "...", "password": "..." }`

### 4. Проблема с хешированием пароля
Убедитесь, что пароль в базе данных правильно захеширован. При создании пользователя пароль должен хешироваться (например, через bcrypt).

### 5. Проблема с CORS
Проверьте, что бэкенд разрешает запросы с фронтенда (CORS настроен правильно).

## Диагностика

### Шаг 1: Проверьте логи в консоли браузера
Откройте DevTools (F12) → Console и посмотрите:
- Какой URL используется для запроса
- Какой формат данных отправляется
- Какой ответ приходит от сервера

### Шаг 2: Проверьте Network tab
Откройте DevTools (F12) → Network:
1. Найдите запрос к `/api/v1/auth/login`
2. Проверьте:
   - Request URL
   - Request Method (должен быть POST)
   - Request Headers (должен быть `Content-Type: application/json`)
   - Request Payload (должен содержать email и password)
   - Response Status (401)
   - Response Body (какое сообщение об ошибке)

### Шаг 3: Проверьте бэкенд
Убедитесь, что:
1. Бэкенд запущен на `http://localhost:5001`
2. Endpoint `/api/v1/auth/login` существует
3. Пользователь существует в базе данных
4. Пароль правильно захеширован

### Шаг 4: Проверьте через curl
Попробуйте войти через curl:

```bash
curl -X POST http://localhost:5001/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"admin123"}'
```

Если это работает, проблема на фронтенде. Если не работает, проблема на бэкенде.

## Решения

### Решение 1: Создать пользователя заново
Если пользователь не существует или пароль неправильный:

```bash
# Создать админа
python3 init_admin_data.py admin@example.com admin123 Имя Фамилия
```

### Решение 2: Проверить формат данных
Убедитесь, что бэкенд ожидает именно `email` и `password` (не `username` или другие поля).

### Решение 3: Проверить хеширование пароля
Если вы создаете пользователя вручную в БД, убедитесь, что пароль правильно захеширован:

```python
from werkzeug.security import generate_password_hash

# Правильный способ хеширования
hashed_password = generate_password_hash('admin123')
```

### Решение 4: Проверить логи бэкенда
Посмотрите логи бэкенда при попытке входа - там может быть более детальная информация об ошибке.

## Улучшения в коде

Я уже улучшил обработку ошибок в `src/http/api.js`:
- Теперь при ошибке 401 показывается понятное сообщение "Неверный email или пароль"
- Добавлено логирование запросов и ответов в режиме разработки

## Следующие шаги

1. Проверьте логи в консоли браузера (должны появиться детали запроса)
2. Проверьте Network tab в DevTools
3. Убедитесь, что пользователь существует в БД
4. Попробуйте войти через curl для проверки бэкенда
5. Проверьте логи бэкенда

